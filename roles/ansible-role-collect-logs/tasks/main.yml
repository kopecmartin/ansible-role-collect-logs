---
- name: gather facts used by role
  setup:
    gather_subset: "!min,pkg_mgr,python"
  when: "['pkg_mgr', 'python'] | difference(ansible_facts.keys()|list)"

- name: Load operating system specific variables
  include_vars: "{{ item }}"
  failed_when: false
  # pattern: v3
  loop:
    - "family-{{ ansible_os_family | lower }}.yml"
    - "family-{{ ansible_os_family | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution | lower | replace(' ', '-') }}.yml"
    - "{{ ansible_distribution | lower | replace(' ', '-') }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution | lower | replace(' ', '-') }}-{{ ansible_distribution_version.split('.')[0:2] | join('-') | lower }}.yml"
  tags:
    - always

- name: Collect logs
  include: collect.yml
  when: artcl_collect|bool
